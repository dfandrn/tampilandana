<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DANA Demo Full</title>
<style>
  body{margin:0;font-family:sans-serif;background:#f4f5f7;overflow-x:hidden;}
  .hidden{display:none;}
  .bottom-nav{position:fixed;bottom:0;width:100%;display:flex;background:white;box-shadow:0 -2px 6px rgba(0,0,0,0.1);}
  .bottom-nav button{flex:1;padding:12px;border:none;background:none;cursor:pointer;font-weight:bold;}
  .bottom-nav button.active{color:#00aaef;}
  .sheet{position:fixed;bottom:-100%;left:0;width:100%;background:white;transition:0.3s;border-top-left-radius:16px;border-top-right-radius:16px;z-index:1000;}
  .sheet.open{bottom:0;}
  .sheet .handle{width:40px;height:4px;background:#ccc;margin:8px auto;border-radius:2px;}
  .sheet .title{text-align:center;font-weight:bold;margin-bottom:8px;}
  .sheet .body{padding:16px;max-height:70vh;overflow-y:auto;}
  .price-card{background:#fff;padding:10px;border-radius:12px;text-align:center;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.1);transition:0.2s;}
  .price-card.active{border:2px solid #00aaef;transform:scale(1.05);}
  .pill{font-size:10px;color:#888;}
  .bg-white{background:white;}
  .rounded-xl{border-radius:16px;}
  .p-3{padding:12px;}
  .mb-3{margin-bottom:12px;}
  .border{border:1px solid #ddd;}
  .text-xs{font-size:12px;}
  .text-sm{font-size:14px;}
  .font-semibold{font-weight:600;}
  .flex{display:flex;}
  .justify-between{justify-content:space-between;}
  .items-center{align-items:center;}
  .mt-1{margin-top:4px;}
  .mt-2{margin-top:8px;}
  .mt-3{margin-top:12px;}
  .w-full{width:100%;}
  .px-3{padding-left:12px;padding-right:12px;}
  .py-2{padding-top:8px;padding-bottom:8px;}
  .grid{display:grid;}
  .grid-cols-3{grid-template-columns:repeat(3,1fr);}
  .gap-2{gap:8px;}
  .bg-amber-50{background:#fff8e1;}
  .border-amber-100{border-color:#ffe082;}
  .font-mono{font-family:monospace;}
  button{cursor:pointer;}
  
  /* Custom popup */
  .popup-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:0.3s;z-index:9999;}
  .popup-overlay.show{opacity:1;visibility:visible;}
  .popup-content{background:white;padding:20px;border-radius:16px;max-width:300px;width:90%;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,0.3);}
  .popup-title{font-weight:bold;font-size:16px;margin-bottom:10px;}
  .popup-message{font-size:14px;margin-bottom:20px;}
  .popup-buttons button{padding:8px 16px;border:none;border-radius:8px;margin:0 5px;cursor:pointer;}
  .popup-ok{background:#00aaef;color:white;}
  .popup-cancel{background:#ccc;color:#333;}
</style>
</head>
<body>

<div id="mainScroll">
  <div style="padding:16px;">
    <h2>DANA Demo</h2>
    <div>Saldo: <span id="balance">0</span></div>

    <!-- Feature buttons -->
    <div style="display:flex;flex-wrap:wrap;margin-top:16px;gap:8px;">
      <button id="pulsaDataBtn">Pulsa/Data</button>
      <button id="listrikBtn">Listrik</button>
      <button id="googlePlayBtn">Google Play</button>
      <button id="topUpGameBtn">Top Up Game</button>
      <button id="bpjsBtn">BPJS</button>
      <button id="sendMoneyBtn">Kirim Uang</button>
      <button id="qrPayBtn">QRIS</button>
      <button id="danaDealsBtn">Dana Deals</button>
      <button id="topUpBtn">Top Up</button>
      <button id="withdrawBtn">Tarik Saldo</button>
    </div>
  </div>

  <!-- Sheet Template (contoh Pulsa/Data) -->
  <div id="pulsaSheet" class="sheet">
    <div class="handle"></div>
    <div class="title">Pulsa / Data</div>
    <div class="body">
      <div class="bg-white rounded-xl p-3 mb-3 border">
        <label class="text-xs text-gray-500">No. HP</label>
        <input id="pulsaPhone" type="text" placeholder="08xxx" class="w-full border rounded-lg px-3 py-2 mt-1" inputmode="numeric">
        <div id="pulsaInfo" class="text-xs text-gray-500 mt-2 hidden"></div>
      </div>
      <div class="mb-2">
        <div class="flex justify-between items-center">
          <h4 class="font-semibold">Pilih Nominal</h4>
          <button id="pulsaReset" class="text-xs underline">Reset</button>
        </div>
        <div id="pulsaGrid" class="grid grid-cols-3 gap-2 mt-2"></div>
      </div>
      <div id="pulsaSummary" class="bg-amber-50 border border-amber-100 rounded-xl p-3 mt-3 hidden">
        <div class="flex justify-between text-sm"><span>Harga</span><span id="pulsaHarga">Rp0</span></div>
        <div class="flex justify-between text-sm"><span>Diskon</span><span id="pulsaDiskon">- Rp0</span></div>
        <div class="flex justify-between text-sm font-semibold mt-1"><span>Total Bayar</span><span id="pulsaTotal">Rp0</span></div>
        <button id="pulsaBayar" class="w-full mt-3 bg-[#00aaef] text-white rounded-lg py-2 font-medium">Bayar Sekarang</button>
      </div>
    </div>
  </div>

  <!-- Custom Popup -->
  <div id="customPopup" class="popup-overlay">
    <div class="popup-content">
      <div class="popup-title">Info</div>
      <div class="popup-message">Pesan popup</div>
      <div class="popup-buttons">
        <button class="popup-ok">OK</button>
        <button class="popup-cancel">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div class="bottom-nav">
  <button id="tabHome" class="active">Home</button>
  <button id="tabAktivitas">Aktivitas</button>
  <button id="tabWallet">Dompet</button>
</div>

<script>
  // ===== Helpers =====
  const rupiah = n => 'Rp' + (n||0).toLocaleString('id-ID');
  const qs = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
  const storage = {
    get(k,def){try{const v=JSON.parse(localStorage.getItem(k)); return v===null||v===undefined?def:v;}catch(e){return def;}},
    set(k,v){localStorage.setItem(k,JSON.stringify(v));},
    del(k){localStorage.removeItem(k);}
  };
  const BAL_KEY = 'dana_balance';
  const TX_KEY = 'dana_history';

  function showPopup(message,title="Info",onConfirm=null,showCancel=false){
    const popup = qs('#customPopup');
    popup.querySelector('.popup-title').innerText = title;
    popup.querySelector('.popup-message').innerText = message;
    const btnConfirm = popup.querySelector('.popup-ok');
    const btnCancel  = popup.querySelector('.popup-cancel');
    btnConfirm.onclick = ()=>{
      popup.classList.remove('show');
      if(onConfirm) onConfirm();
    };
    if(showCancel){
      btnCancel.style.display='inline-block';
      btnCancel.onclick = ()=> popup.classList.remove('show');
    }else btnCancel.style.display='none';
    popup.classList.add('show');
  }

  // ===== Init Balance =====
  function initBalance(){
    let b = storage.get(BAL_KEY,null);
    if(b===null){b=1000000;storage.set(BAL_KEY,b);}
    qs('#balance').innerText = b.toLocaleString('id-ID');
  }
  initBalance();

  // ===== Pulsa/Data Demo =====
  const pulsaProducts = [
    {nominal:'5.000',  harga:6000,  diskon:500,  label:'Pulsa 5K'},
    {nominal:'10.000', harga:11000, diskon:1000, label:'Pulsa 10K'},
    {nominal:'Data 2GB/7hr',  harga:15000, diskon:2000, label:'Paket Data'}
  ];
  const pulsaGrid = qs('#pulsaGrid'); let pulsaSelected=null;
  function renderPulsaGrid(){
    pulsaGrid.innerHTML='';
    pulsaProducts.forEach((p,i)=>{
      const div=document.createElement('div'); div.className='price-card';
      div.innerHTML=`<div class="text-sm font-semibold">${p.label.includes('Data')?p.label:'Pulsa'}</div>
        <div class="text-xs text-gray-600">${p.nominal}</div>
        <div class="flex items-center justify-between mt-1">
          <div class="text-sm font-semibold">${rupiah(p.harga-p.diskon)}</div>
          <span class="pill">- ${rupiah(p.diskon)}</span>
        </div>`;
      div.addEventListener('click',()=>{ pulsaSelected=i; qsa('#pulsaGrid .price-card').forEach(x=>x.classList.remove('active')); div.classList.add('active'); updatePulsaSummary(); });
      pulsaGrid.appendChild(div);
    });
  }
  renderPulsaGrid();

  function updatePulsaSummary(){
    const sum = qs('#pulsaSummary'); if(pulsaSelected===null){sum.classList.add('hidden');return;}
    const p=pulsaProducts[pulsaSelected];
    qs('#pulsaHarga').innerText = rupiah(p.harga);
    qs('#pulsaDiskon').innerText = '- ' + rupiah(p.diskon);
    qs('#pulsaTotal').innerText = rupiah(p.harga - p.diskon);
    sum.classList.remove('hidden');
  }

  qs('#pulsaReset').addEventListener('click', ()=>{
    pulsaSelected=null; qsa('#pulsaGrid .price-card').forEach(x=>x.classList.remove('active'));
    qs('#pulsaSummary').classList.add('hidden'); qs('#pulsaPhone').value='';
  });

  qs('#pulsaBayar').addEventListener('click', ()=>{
    const phone = qs('#pulsaPhone').value.trim();
    if(!/^0[0-9]{9,13}$/.test(phone)){ showPopup('Nomor HP tidak valid'); return; }
    if(pulsaSelected===null){ showPopup('Pilih nominal dulu'); return; }
    const p=pulsaProducts[pulsaSelected], total=p.harga-p.diskon;
    let bal=storage.get(BAL_KEY,0); if(bal<total){ showPopup('Saldo tidak cukup'); return; }
    bal-=total; storage.set(BAL_KEY,bal); qs('#balance').innerText = bal.toLocaleString('id-ID');

    const tx = storage.get(TX_KEY,[]); tx.unshift({id:'TXN'+Date.now(),ts:new Date().toISOString(),type:'pulsa',target:phone,nominal:p.nominal,harga:p.harga,diskon:p.diskon,total:total,status:'Sukses'}); storage.set(TX_KEY,tx);
    showPopup('Pembelian '+p.label+' '+p.nominal+' untuk '+phone+' berhasil.\nTotal: '+rupiah(total), 'Berhasil', ()=>{ qs('#pulsaReset').click(); });
  });
</script>
</body>
</html>
